<div id='show_page'>

<h1>Currently Showing <%= @critical_process.cp_title %></h1>

<p>
  <b>Secondary ID:</b>
  <%= @critical_process.cp_secondary_id %>
</p>

<div id="cp_intro">
  <b>Introduction:</b> <input type="checkbox" class="topic-checkbox" value="Intro" > <br/>
  <%= @critical_process.cp_intro %>
</div>

<div id='cp_definition'>
  <b>Definition:</b> <input type="checkbox" class="topic-checkbox" value="Definition" > <br/>
  <%= @critical_process.cp_definition %>
</div>

<div id='scopes'>
<div id='in_scope_container'>
  <b>In scope:</b> <input type="checkbox" class="topic-checkbox" value="In-Scope" > <br/>
  <%= @critical_process.in_scope %>
</div>

<div id='out_scope_container'>
  <b>Out scope:</b> <input type="checkbox" class="topic-checkbox" value="Out-Scope" > <br/>
  <%= @critical_process.out_scope %>
</div>
</div>


<div id='cbb_definitions'>
  <h3>Description of categories and underlying capability building blocks</h3>
  <table border="1">
    <tr>
      <th>Categories</th>
      <th>Capability Building Blocks</th>
      <th>Description</th>
    </tr>
    <% for category in @categories %>
        <tr>
          <td rowspan="<%= category.capability_building_blocks.size %>"><%= category.category_title %></td>
          <td><%= category.capability_building_blocks.first.cbb_title %></td>
          <td><%= category.capability_building_blocks.first.cbb_definition %></td>
        </tr>
        <% (category.capability_building_blocks - [category.capability_building_blocks.first]).each do |cbb| %>
        <tr>
          <td><%= cbb.cbb_title %></td>
          <td><%= cbb.cbb_definition %></td>
        </tr>
        <% end %>
    <% end %>
  </table>

</div>

<div id='CBB_maturity_show'>
  <h3>Summary maturity curve for capability building blocks</h3>
  <table border="1">
    <tr>
      <th>Categories</th>
      <th>CBB's</th>
      <th>Level 1</th>
      <th>Level 2</th>
      <th>Level 3</th>
      <th>Level 4</th>
      <th>Level 5</th>
    </tr>
    <% for category in @categories %>
        <tr>
          <td rowspan="<%= category.capability_building_blocks.size %>"><%= category.category_title %></td>
          <td><%= category.capability_building_blocks.first.cbb_title %></td>
          <td><%= category.capability_building_blocks.first.level_1_cbb %></td>
          <td><%= category.capability_building_blocks.first.level_2_cbb %></td>
          <td><%= category.capability_building_blocks.first.level_3_cbb %></td>
          <td><%= category.capability_building_blocks.first.level_4_cbb %></td>
          <td><%= category.capability_building_blocks.first.level_5_cbb %></td>
        </tr>
        <% (category.capability_building_blocks - [category.capability_building_blocks.first]).each do |cbb| %>
        <tr>
          <td><%= cbb.cbb_title %></td>
          <td><%= cbb.level_1_cbb %></td>
          <td><%= cbb.level_2_cbb %></td>
          <td><%= cbb.level_3_cbb %></td>
          <td><%= cbb.level_4_cbb %></td>
          <td><%= cbb.level_5_cbb %></td>
        </tr>
        <% end %>
    <% end %>

  </table>
</div>
<div id='lessons_learned_show'>
<h3>Summary of insights and lessons learned</h3>

  <table border="1">
    <tr>
      <th>Question</th>
      <th>Lessons Learned</th>
    </tr>
    <% for lesson in @lessons%>
        <tr>
          <td><input type="checkbox" class="topic-checkbox" value="Lesson: <%= lesson.lesson_title  %>" ><%= lesson.lesson_title%> </td>
          <td><%= lesson.lesson_definition %></td>

        </tr>
    <% end %>
  </table>
</div>

<p>
  <b>Key term's</b>
  <% if @critical_process.key_terms.count > 0 %>
      <%= @key_terms.collect { |key_term| link_to key_term.term, key_term }.join(", ") %>
  <% else %>
      This process has no Key terms
  <% end %>
</p>

    <div id="comments">

      <!-- display all comments for this cp, in order of date added, with the user that wrote them and .  -->
      <% for comment in @comments %>
          <hr>
          <br/>

          <div id="comment">
            <%= h comment.comment %> <br/>
            Relating to the following topics: <%= h comment.topics %><br/>
            By: <%= h comment.user.email %>
            <br/>
            Left on: <%= h comment.updated_at %>

          </div>
      <% end %>

    </div>

    <div id="comment_form">

      <!-- here we will have an if statement that will check to see if the user if a reviewer or editor and if so allow to leave a comment, this can be a pop up window that contains the form and calls an ajax call to add the comment.  -->

      <% @comment = Comment.new %>
      <%= form_for(@comment) do |f| %>


          <div class="field">
            <%= f.label :comment %>
            <br/>
            <%= f.text_area :comment %>
          </div>
          <div class="field">
            <%= f.hidden_field :review_id, :value => @critical_process.review.id %>
          </div>
          <div class="field">
            <%= f.hidden_field :user_id, :value => current_user.id %>
          </div>
          <div class="field">
            <%= f.hidden_field :topics, :id => "comment_topics", :value => '' %>
          </div>
          <div class="actions">
            <%= f.submit %>
          </div>
      <% end %>

    </div>

<% if current_user.can_review(@critical_process) || current_user.is_admin%>
<div id='review_form'>

  <!-- have a button that's only visible to admins and editors which depending on the stage of the CP allows them to approve it to the next stage. -->
  <% @review = @critical_process.review %>
  <%= form_for(@review) do |f| %>


      <% if @review.stage == 'approved' %>

          <div class="field">
            <%= f.hidden_field :stage, :value => '3' %>
          </div>
          This CP has been Approved.
          <div class="actions">
            <%= f.submit "Pull back CP to level 3" %>
          </div>
      <% else %>

          <div class="field">
            <%= f.hidden_field :stage, :value => @new_stage %>

          </div>
          <div class="actions">

            <%= f.submit "Approve CP to level #{@new_stage}" %>
          </div>
      <% end %>
  <% end %>
</div>
<% end %>
<% if current_user.is_admin || current_user.can_edit(@critical_process) %>
<%= link_to 'Edit', edit_critical_process_path(@critical_process) %> |
<% end %>
<%= link_to 'Back', critical_processes_path %>
<%= link_to 'show all versions', all_versions_critical_process_path(@critical_process.cp_secondary_id) %>

</div>